{"version":3,"file":"decorator.js","sources":["../src/click-controller.ts","../src/events.ts","../src/element-drag-controller.ts","../src/subscribable.ts","../src/input.ts","../src/mouse-click-input.ts","../src/mouse-drag-input.ts","../src/view.ts","../src/pan-decorator.ts","../src/model.ts","../src/touch-drag-input.ts","../src/mouse-wheel-input.ts","../src/zoom-decorator.ts"],"sourcesContent":["import { ClickInput } from './click-mediator';\nimport { Unsubscription } from './subscribable';\nimport { getEventPosition } from './events';\n\nexport type ClickCallback = (event: MouseEvent) => void;\n\n/**\n * Calls a callback whenever the mouse is moved while being clicked.\n */\nexport class ClickController {\n  private unsubscription?: Unsubscription;\n\n  constructor(private clickInput: ClickInput, private callback: ClickCallback) {\n    this.enable();\n  }\n\n  enable(): void {\n    this.disable();\n    this.unsubscription = this.clickInput.subscribe({\n      click: this.callback,\n    });\n  }\n\n  disable(): void {\n    if (this.unsubscription !== undefined) {\n      this.unsubscription();\n    }\n  }\n}\n","import { V4, Vec4 } from 'coordinates';\n\nexport interface LocalizableEvent {\n  clientX: number;\n  clientY: number;\n  target: EventTarget | null;\n}\n\nexport interface DeltaEvent {\n  deltaX: number;\n  deltaY: number;\n  target: EventTarget | null;\n}\n\n/* TODO: Pass the viewport coordinate system */\nexport function getEventPosition(event: LocalizableEvent): Vec4 {\n  // getBoundingClientRect is slow\n  const rect = (event.target as any).getBoundingClientRect();\n  return V4(\n    event.clientX - rect.left,\n    event.clientY - rect.top,\n    0,\n    1,\n  );\n}\n\n// export function getEventPositionA(event: MouseEvent | Touch, position: { x: number; y: number }): void {\n//   // getBoundingClientRect is slow\n//   const rect = (event.target as any).getBoundingClientRect();\n//   position.x = event.clientX - rect.left;\n//   position.y = event.clientY - rect.top;\n// }\n","import { Vec4 } from 'coordinates';\n\nimport { DragMediator } from './drag-mediator';\nimport { Unsubscription } from './subscribable';\nimport { getEventPosition } from './events';\nimport { View } from './view';\n\n/**\n * Changes the (style.) left and top value depending on the drag input.\n * Element must be positioned absolutely.\n */\nexport class ElementDragController {\n  private unsubscription?: Unsubscription;\n\n  constructor(private element: HTMLElement, private view: View<DragMediator>) {\n    this.enable();\n  }\n\n  enable(): void {\n    // Avoid multiple subscription by disabling first.\n    this.disable();\n    let startPosition: Vec4;\n    this.unsubscription = this.view.subscribe({\n      down: events => startPosition = getEventPosition(events[0]),\n      move: events => {\n        const movePosition = getEventPosition(events[0]);\n        this.element.style.left = `${this.element.offsetLeft + movePosition.x - startPosition.x}px`;\n        this.element.style.top = `${this.element.offsetTop + movePosition.y - startPosition.y}px`;\n      },\n      up: _ => { /* do nothing */ },\n    });\n  }\n\n  disable(): void {\n    if (this.unsubscription !== undefined) {\n      this.unsubscription();\n    }\n  }\n}\n","export type Unsubscription = () => void;\n\n/**\n * An object you can subscribe to and unsubscribe.\n */\nexport interface Subscribable<T> {\n  subscribe(mediator: T): Unsubscription;\n}\n\n/**\n * Return a default implementation for subscribe. Typescript does not provide\n * a clean mixin implementation, requiring the use of strange construction in\n * order to mix base implementation. The blocker being that Typescript does not\n * allow partial template inference, thus things like: https://stackoverflow.com/a/55601197/2603925\n * is not possible if the implementation class requires a type parameter:\n *\n * class Foo<U> extends Bar<U>(Bazz()) implements IBar, IBazz {...\n *                         ^^^\n *                          fails here because missing T specifier.\n */\nexport function BaseSubscribable<T>(clients: T[]): (t: T) => Unsubscription {\n  return (mediator: T): Unsubscription => {\n    // push the mediator into the list of subscribed clients...\n    const index = clients.push(mediator) - 1;\n    // ... and return a function which allows to remove that client from the list.\n    return () => clients.splice(index, 1);\n  }\n}\n","import { Enableable } from './enableable';\nimport { BaseSubscribable, Subscribable } from './subscribable';\n\n/**\n * A partially implemented Input interface.\n * See the documentation for BaseSubscribable for more details on why class mixins\n * are not practical in that situation.\n */\nexport abstract class Input<T> implements Enableable, Subscribable<T> {\n  protected clients: T[] = [];\n  abstract enable(): void;\n  abstract disable(): void;\n  subscribe = BaseSubscribable<T>(this.clients);\n}\n\nexport enum MouseButton {\n  LEFT = 0,    // Main button pressed, usually the left button or the un-initialized state\n  MIDDLE = 1,  // Auxiliary button pressed, usually the wheel button or the middle button (if present)\n  RIGHT = 2,   // Secondary button pressed, usually the right button\n  BACK = 3,    // Fourth button, typically the Browser Back button\n  FORWARD = 4, // Fifth button, typically the Browser Forward button\n}\n","import { ClickInput, ClickMediator } from './click-mediator';\nimport { Input, MouseButton } from './input';\nimport { BaseSubscribable, Unsubscription } from './subscribable';\n\nexport class MouseClickInput extends Input<ClickMediator> {\n  constructor(private element: HTMLElement, private button: number = MouseButton.LEFT) {\n    super();\n    this.enable();\n  }\n\n  enable(): void {\n    this.disable();\n    this.element.addEventListener('mousedown', this.mousedown);\n    this.element.addEventListener('mouseup', this.mouseup);\n    this.element.addEventListener('click', this.click);\n  }\n\n  disable(): void {\n    this.element.removeEventListener('mousedown', this.mousedown);\n    this.element.removeEventListener('mouseup', this.mouseup);\n    this.element.removeEventListener('click', this.click);\n  }\n\n  private mousedown = (event: MouseEvent): void => {\n    if (event.button === this.button) {\n      this.clients.forEach(c => {\n        if (c.down !== undefined) {\n          c.down(event);\n        }\n      });\n    }\n  }\n\n  private mouseup = (event: MouseEvent): void => {\n    if (event.button === this.button) {\n      this.clients.forEach(c => {\n        if (c.up !== undefined) {\n          c.up(event);\n        }\n      });\n    }\n  }\n\n  private click = (event: MouseEvent): void => {\n    if (event.button === this.button) {\n      this.clients.forEach(c => c.click(event));\n    }\n  }\n}\n","import { DragMediator } from './drag-mediator';\nimport { Input, MouseButton } from './input';\nimport { Unsubscription } from './subscribable';\n\n/**\n * Calls the DragMediator when the mouse is moved while clicked on a specified\n * element.\n */\nexport class MouseDragInput extends Input<DragMediator> {\n  constructor(private element: HTMLElement, private button: number = MouseButton.LEFT) {\n    super();\n    this.enable();\n  }\n\n  enable(): void {\n    this.disable();\n    this.element.addEventListener('mousedown', this.mousedown);\n  }\n\n  disable(): void {\n    this.element.removeEventListener('mousedown', this.mousedown);\n  }\n\n  private mousedown = (event: MouseEvent): void => {\n    if (event.button === this.button) {\n      document.addEventListener('mousemove', this.mousemove);\n      document.addEventListener('mouseup', this.mouseup);\n      this.clients.forEach(c => c.down([event]));\n    }\n  }\n\n  private mousemove = (event: MouseEvent): void => {\n    this.clients.forEach(c => c.move([event]));\n  }\n\n  private mouseup = (event: MouseEvent): void => {\n    document.removeEventListener('mousemove', this.mousemove);\n    document.removeEventListener('mouseup', this.mouseup);\n    this.clients.forEach(c => c.up([event]));\n  }\n}\n","import { Enableable } from './enableable';\nimport { BaseSubscribable, Subscribable, Unsubscription } from './subscribable';\nimport { Input } from './input';\n\n/**\n * A partially implemented View interface.\n * See the documentation for BaseSubscribable for more details on why class mixins\n * are not practical in that situation.\n */\nexport abstract class View<T> implements Enableable, Subscribable<T> {\n  protected clients: T[] = [];\n  abstract enable(): void;\n  abstract disable(): void;\n  subscribe = BaseSubscribable<T>(this.clients);\n}\n\n/**\n * Act as a pass through.\n */\nexport class PassThroughView<T> extends View<T> {\n  private unsubscription?: Unsubscription;\n\n  constructor(private input: Input<T>) {\n    super();\n    this.enable();\n  }\n\n  // Pass-through. Nothing gets done here.\n  subscribe = (mediator: T): Unsubscription => {\n    this.unsubscription = this.input.subscribe(mediator);\n    return this.unsubscription;\n  }\n\n  enable(): void {\n    this.disable();\n  }\n\n  disable(): void {\n    if (this.unsubscription !== undefined) {\n      this.unsubscription();\n    }\n  }\n}","import { Vector, Vec3 } from 'coordinates';\n\nimport { Camera } from './camera';\nimport { Decorator } from './decorator';\nimport { MutableModel } from './model';\nimport { LocalizableEvent, getEventPosition } from './events';\nimport { Controller } from './controller';\nimport { Unsubscription } from './subscribable';\nimport { PassThroughView, View } from './view';\nimport { DragMediator } from './drag-mediator';\nimport { MouseDragInput } from './mouse-drag-input';\nimport { MouseButton } from './input';\n\nexport class PanController<T extends Camera> implements Controller {\n  private unsubscription?: Unsubscription;\n\n  constructor(private readonly model: MutableModel<T>, private view: View<DragMediator>) {\n    this.enable();\n  }\n\n  enable(): void {\n    this.disable();\n    let start: LocalizableEvent;\n    let previous: LocalizableEvent;\n    this.unsubscription = this.view.subscribe({\n      down: events => { start = events[0]; previous = events[0]; },\n      move: events => {\n        const current = events[0];\n        this.model.apply(camera => {\n          const previousPosition = getEventPosition(previous);\n          const currentPosition = getEventPosition(current);\n          currentPosition.subA(previousPosition.x, previousPosition.y, previousPosition.z);\n          camera.eye.addA(currentPosition.x, currentPosition.y, currentPosition.z);\n          camera.look.addA(currentPosition.x, currentPosition.y, currentPosition.z);\n        });\n\n        previous = current;\n      },\n      up: event => { /* do nothing */ },\n    });\n  }\n\n  disable(): void {\n    if (this.unsubscription !== undefined) {\n      this.unsubscription();\n    }\n  }\n}\n\nexport class PanDecorator implements Decorator {\n  static create<T extends Camera>(element: HTMLElement, model: MutableModel<T>): PanDecorator {\n    return new PanDecorator(new PanController(model, new PassThroughView(new MouseDragInput(element, MouseButton.LEFT))));\n  }\n\n  enable(): void { this.controller.disable(); }\n  disable(): void { this.controller.enable(); }\n\n  constructor(private readonly controller: Controller) {}\n}\n","import { Observable, Subject } from '@jdmichaud/observable';\n\nexport class Model<T> extends Subject<T> {\n  constructor(protected underlying: T) {\n    super();\n  }\n\n  get(): T { return this.underlying; }\n}\n\nexport type NonMutableModel<T> = Model<T>;\n\n// export class AggregateModel<T> extends Model<T> {\n//   constructor(underlying: T, observables: Array<Observable<any>>) {\n//     super(underlying);\n//     observables.forEach(observable => observable.subscribe(_ => this.next(this.underlying)));\n//   }\n// }\n\nexport class MutableModel<T> extends Model<T> {\n  constructor(underlying: T) {\n    super(underlying);\n  }\n\n  apply(changeFunction: (underlying: T) => void): void {\n    changeFunction(this.underlying);\n    this.next(this.underlying);\n  }\n\n  touch(): void {\n    this.next(this.underlying);\n  }\n}\n\n/**\n * Converts a subject to another subject which object extracted from the original object.\n * Useful to limit function parameters to the requested model\n * ex.:\n * function foo(lookModel: Model<Vector>) { lookModel.subscribe(look => ...); }\n * foo(watch(cameraModel, (camera) => camera.look));\n * Here foo is not expecting the full Camera, only a vector.\n */\nexport function focus<T, U>(model: NonMutableModel<T>, extractor: (u: T) => U): NonMutableModel<U> {\n  const subModel = new Model<U>(extractor(model.get()));\n\n  model.subscribe(underlying => {\n    subModel.next(extractor(underlying))\n  });\n\n  return subModel;\n}\n\n/**\n * Converts a array of subject to a subject of array.\n */\nexport function watchAll(models: Array<NonMutableModel<any>>): NonMutableModel<Array<any>> {\n  const watchModel = new Model<Array<any>>(models.map(m => m.get()));\n  models.forEach(m => m.subscribe(u => watchModel.next(models.map(m => m.get()))));\n  return watchModel;\n}\n","import { DragMediator } from './drag-mediator';\nimport { Input, MouseButton } from './input';\nimport { Unsubscription } from './subscribable';\nimport { DeltaEvent } from './events';\n\n/**\n */\nexport class TouchDragInput extends Input<DragMediator> {\n  constructor(private element: HTMLElement, private nbFingers: number = 1) {\n    super();\n    this.enable();\n  }\n\n  enable(): void {\n    this.disable();\n    this.element.addEventListener('touchstart', this.touchstart);\n  }\n\n  disable(): void {\n    this.element.removeEventListener('touchmove', this.touchstart);\n  }\n\n  private touchstart = (event: TouchEvent): void => {\n    if (event.touches.length == this.nbFingers) {\n      document.addEventListener('touchmove', this.touchmove);\n      document.addEventListener('touchend', this.touchend);\n      this.clients.forEach(c => c.down(Array.from(event.touches)));\n    }\n  }\n\n  private touchmove = (event: TouchEvent): void => {\n    this.clients.forEach(c => c.move(Array.from(event.touches)));\n  }\n\n  private touchend = (event: TouchEvent): void => {\n    document.removeEventListener('touchmove', this.touchmove);\n    document.removeEventListener('touchend', this.touchend);\n    this.clients.forEach(c => c.up(Array.from(event.touches)));\n  }\n}\n","import { DeltaMediator } from './delta-mediator';\nimport { Input, MouseButton } from './input';\nimport { Unsubscription } from './subscribable';\nimport { DeltaEvent, LocalizableEvent } from './events';\n\n/**\n * Calls the DragMediator when the mouse is moved while clicked on a specified\n * element.\n */\nexport class MouseWheelInput extends Input<DeltaMediator<DeltaEvent & LocalizableEvent>> {\n  constructor(private element: HTMLElement) {\n    super();\n    this.enable();\n  }\n\n  enable(): void {\n    this.disable();\n    this.element.addEventListener('wheel', this.wheel);\n  }\n\n  disable(): void {\n    this.element.removeEventListener('wheel', this.wheel);\n  }\n\n  private wheel = (event: WheelEvent): void => {\n    this.clients.forEach(c => c.delta(event));\n  }\n}\n","import { Vector, Vec3 } from 'coordinates';\n\nimport { Camera } from './camera';\nimport { DeltaDragView } from './delta-view';\nimport { Decorator } from './decorator';\nimport { DeltaInput } from './delta-mediator';\nimport { MutableModel, NonMutableModel } from './model';\nimport { DeltaEvent, LocalizableEvent, getEventPosition } from './events';\nimport { Controller } from './controller';\nimport { Unsubscription } from './subscribable';\nimport { View, PassThroughView } from './view';\nimport { DeltaMediator } from './delta-mediator';\nimport { MouseWheelInput } from './mouse-wheel-input';\n\nfunction zoomCamera(camera: Camera, center: Vector, deltaY: number): Camera {\n  return camera;\n}\n\nexport class ZoomController<T extends Camera> implements Controller {\n  protected unsubscription?: Unsubscription;\n\n  constructor(private readonly model: MutableModel<T>, private center: NonMutableModel<Vector>,\n    private view: View<DeltaMediator<DeltaEvent>>) {\n    this.enable();\n  }\n\n  enable(): void {\n    this.disable();\n    this.unsubscription = this.view.subscribe({\n      delta: event => {\n        this.model.apply(camera => {\n          const newCamera = zoomCamera(camera, this.center.get(), event.deltaY);\n          camera.look = newCamera.look;\n          camera.eye = newCamera.eye;\n          camera.fov = newCamera.fov;\n        })\n      },\n    });\n  }\n\n  disable(): void {\n    if (this.unsubscription !== undefined) {\n      this.unsubscription();\n    }\n  }\n}\n\nexport class ZoomFocusController<T extends Camera> implements Controller {\n  protected unsubscription?: Unsubscription;\n\n  constructor(private readonly model: MutableModel<T>,\n    private view: View<DeltaMediator<DeltaEvent & LocalizableEvent>>) {\n    this.enable();\n  }\n\n  enable(): void {\n    this.disable();\n    let start: LocalizableEvent;\n    let previous: LocalizableEvent;\n    this.unsubscription = this.view.subscribe({\n      delta: event => {\n        this.model.apply(camera => {\n          const center = getEventPosition(event);\n          const newCamera = zoomCamera(camera, center, event.deltaY);\n          camera.look = newCamera.look;\n          camera.eye = newCamera.eye;\n          camera.fov = newCamera.fov;\n        })\n      },\n    });\n  }\n\n  disable(): void {\n    if (this.unsubscription !== undefined) {\n      this.unsubscription();\n    }\n  }\n}\n\nexport class ZoomDecorator<T extends Camera> implements Decorator {\n  static create<T extends Camera>(element: HTMLElement, model: MutableModel<T>): ZoomDecorator<T> {\n    return new ZoomDecorator(\n      new ZoomFocusController(\n        model,\n        new PassThroughView(\n          new MouseWheelInput(element)\n        )\n      )\n    );\n  }\n\n  enable(): void { this.controller.disable(); }\n  disable(): void { this.controller.enable(); }\n\n  constructor(private readonly controller: Controller) {}\n}\n"],"names":["V4","MouseButton","Subject"],"mappings":"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"}